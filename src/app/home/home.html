<div class="home-layout">
  <div class="filters glassy-card">
    <h3>Filters</h3>
    <div class="filter-group">
      <label class="filter-group-label">Type</label>
      <mat-selection-list [(ngModel)]="filters.selectedTypes" (ngModelChange)="applyFilters()">
        <mat-list-option *ngFor="let t of toyTypes()" [value]="t">
          {{ t }}
        </mat-list-option>
      </mat-selection-list>
    </div>

    <div class="filter-group">
      <label class="filter-group-label">Age Group</label>
      <mat-selection-list [(ngModel)]="filters.selectedAgeGroup" (ngModelChange)="applyFilters()">
        <mat-list-option *ngFor="let t of ageGroups()" [value]="t">
          {{ t }}
        </mat-list-option>
      </mat-selection-list>
    </div>

    <div class="filter-group">
      <label class="filter-group-label">Target Group</label>
      <mat-selection-list [(ngModel)]="filters.selectedTargetGroups" (ngModelChange)="applyFilters()">
        <mat-list-option value="devojčica">Girl</mat-list-option>
        <mat-list-option value="dečak">Boy</mat-list-option>
        <mat-list-option value="svi">Unisex</mat-list-option>
      </mat-selection-list>
    </div>
    <div class="price-inputs">
      <mat-form-field appearance="fill" class="half-width">
        <mat-label>Min Price</mat-label>
        <input matInput type="number" [(ngModel)]="filters.minPriceFilter" (keyup.enter)="checkPriceBounds()">
      </mat-form-field>

      <mat-form-field appearance="fill" class="half-width">
        <mat-label>Max Price</mat-label>
        <input matInput type="number" [(ngModel)]="filters.maxPriceFilter"  (keyup.enter)="checkPriceBounds()">
      </mat-form-field>
    </div>

    <div class="filter-group">
      <label class="filter-group-label">Rating</label>
      <mat-selection-list [(ngModel)]="filters.selectedRating" (ngModelChange)="applyFilters()">
        <mat-list-option *ngFor="let r of [1,2,3,4,5]" [value]="r">
          <ng-container *ngFor="let star of [1,2,3,4,5]">
            <mat-icon [class.filled]="star <= r">star</mat-icon>
          </ng-container>
        </mat-list-option>
      </mat-selection-list>
    </div>
    <div class="filter-buttons">
      <button mat-raised-button color="accent" (click)="resetFilters()">Reset</button>
    </div>
  </div>

  <div class="main-content">

    <div class="top-bar">
      <mat-form-field appearance="fill" class="sort-field">
        <mat-label>Sort by</mat-label>
        <mat-select [(ngModel)]="sortOption" (selectionChange)="applyFilters()">
          <mat-option value="priceAsc">Price: Low to High</mat-option>
          <mat-option value="priceDesc">Price: High to Low</mat-option>
          <mat-option value="nameAsc">Name: A → Z</mat-option>
          <mat-option value="nameDesc">Name: Z → A</mat-option>
          <mat-option value="ratingAsc">Rating: Low to High</mat-option>
          <mat-option value="ratingDesc">Rating: High to Low</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search </mat-label>
        <input matInput [(ngModel)]="filters.searchTerm" (input)="applyFilters()">
        <button mat-icon-button matSuffix (click)="applyFilters()">
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>
    </div>

    <div class="home-container">
      <div *ngFor="let toy of filteredToys()" class="toy-card glassy-card fade-in" (click)="goToDetails(toy.toyId)">
        <div class="toy-image">
          <img [src]="getImage(toy.toyId)" alt="{{ toy.name }}" />
        </div>

        <div class="toy-body">
          <h5 class="toy-title text-gradient">{{ toy.name }}</h5>
          <p class="toy-description">{{ toy.description }}</p>
          <p class="toy-age">Age: {{ toy.ageGroup.name }}</p>
          <p class="toy-price">Price: {{ toy.price }} RSD</p>

          <p class="toy-rating">
            <ng-container *ngFor="let star of [1,2,3,4,5]">
              <mat-icon [class.filled]="star <= getAverageRating(toy)">star</mat-icon>
            </ng-container>
            <span class="rating-value">({{ getAverageRating(toy) | number:'1.1-1'}})</span>
          </p>
        </div>

        <div class="toy-footer text-center">
          <a [routerLink]="['/details', toy.toyId]" class="btn btn-primary glowing-btn me-2">
            <mat-icon>info</mat-icon> Details
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
